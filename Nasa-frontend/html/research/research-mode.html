<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Mode | NASA Space Explorer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Rajdhani', sans-serif;
        }

        body {
            background: #0a0a0f;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(45, 15, 90, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(20, 30, 100, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(70, 15, 60, 0.4) 0%, transparent 50%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: rgba(10, 10, 20, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 2px solid #00e5ff;
            box-shadow: 0 5px 30px rgba(0, 229, 255, 0.3);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            color: #fff;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 15px #00e5ff;
        }

        .logo i {
            margin-right: 15px;
            color: #00e5ff;
            font-size: 32px;
        }

        .back-btn {
            background: linear-gradient(45deg, #00e5ff, #ff00c8);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Orbitron', sans-serif;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 5px 15px rgba(0, 229, 255, 0.4);
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 0, 200, 0.6);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        /* Page Title */
        .page-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-title h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00e5ff, #ff00c8, #ffeb3b);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            text-shadow: none;
            margin-bottom: 20px;
            font-family: 'Orbitron', sans-serif;
        }

        .page-title p {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Research Mode Navigation */
        .research-nav {
            background: rgba(10, 10, 20, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 40px;
            border: 2px solid rgba(0, 229, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .research-tabs {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .research-tab {
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 229, 255, 0.3);
            border-radius: 25px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .research-tab:hover {
            border-color: #00e5ff;
            color: #00e5ff;
            transform: translateY(-2px);
        }

        .research-tab.active {
            background: linear-gradient(45deg, #00e5ff, #ff00c8);
            border-color: transparent;
            color: white;
            box-shadow: 0 5px 20px rgba(0, 229, 255, 0.5);
        }

        /* Research Panels */
        .research-content {
            min-height: 600px;
        }

        .research-panel {
            background: rgba(15, 15, 30, 0.9);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(0, 229, 255, 0.3);
            display: none;
        }

        .research-panel.active {
            display: block;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .panel-header h3 {
            color: #00e5ff;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .research-select,
        .research-input {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 229, 255, 0.3);
            border-radius: 8px;
            color: white;
            padding: 10px 15px;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }

        .research-select:focus,
        .research-input:focus {
            outline: none;
            border-color: #00e5ff;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.3);
        }

        .research-btn {
            background: linear-gradient(45deg, #00e5ff, #ff00c8);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
        }

        .research-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 229, 255, 0.4);
        }

        /* Chart Container */
        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }

        .chart-container h4 {
            color: #00e5ff;
            margin-bottom: 20px;
            font-family: 'Orbitron', sans-serif;
        }

        /* Data Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .data-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 229, 255, 0.2);
            transition: all 0.3s ease;
        }

        .data-card:hover {
            border-color: #00e5ff;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 229, 255, 0.2);
        }

        .data-card h4 {
            color: #00e5ff;
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .data-card p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 8px;
        }

        /* APOD Gallery */
        .apod-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .apod-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(0, 229, 255, 0.2);
            transition: all 0.3s ease;
        }

        .apod-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 229, 255, 0.3);
        }

        .apod-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .apod-content {
            padding: 20px;
        }

        .apod-title {
            color: #00e5ff;
            font-weight: 600;
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .apod-date {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .apod-explanation {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .apod-link {
            color: #ff00c8;
            text-decoration: none;
            font-weight: 600;
        }

        .apod-link:hover {
            color: #00e5ff;
        }

        /* Papers List */
        .papers-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .paper-item {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 229, 255, 0.2);
            transition: all 0.3s ease;
        }

        .paper-item:hover {
            border-color: #00e5ff;
            transform: translateX(5px);
        }

        .paper-title {
            color: #00e5ff;
            font-weight: 600;
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .paper-authors {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            font-style: italic;
        }

        .paper-date {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .paper-abstract {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .paper-link {
            color: #ff00c8;
            text-decoration: none;
            font-weight: 600;
        }

        .paper-link:hover {
            color: #00e5ff;
        }

        /* Loading and Error States */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(0, 229, 255, 0.3);
            border-top: 4px solid #00e5ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.2rem;
            font-family: 'Orbitron', sans-serif;
        }

        .error-state {
            text-align: center;
            padding: 60px 20px;
            color: rgba(255, 255, 255, 0.8);
        }

        .error-icon {
            font-size: 3rem;
            color: #ff6b6b;
            margin-bottom: 20px;
        }

        /* Analysis Dashboard */
        .analysis-dashboard {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .analysis-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #00e5ff;
            font-family: 'Orbitron', sans-serif;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
        }

        .chart-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }

        .chart-item h4 {
            color: #00e5ff;
            margin-bottom: 20px;
            font-family: 'Orbitron', sans-serif;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .page-title h1 {
                font-size: 2.5rem;
            }

            .research-nav {
                padding: 20px;
            }

            .research-panel {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 15px;
            }

            .header-content {
                padding: 0 15px;
                flex-direction: column;
                gap: 15px;
            }

            .page-title h1 {
                font-size: 2rem;
            }

            .research-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .research-tab {
                white-space: nowrap;
                flex-shrink: 0;
            }

            .panel-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <i class="fas fa-satellite"></i>
                Space Explorer
            </a>
            <div class="nav-actions">
                <a href="menu.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Back to Menu
                </a>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Page Title -->
        <div class="page-title">
            <h1><i class="fas fa-microscope"></i> Research Mode</h1>
            <p>Explore, analyze, and visualize real space research data from NASA, arXiv, and other scientific sources. Conduct advanced data analysis with interactive charts and insights.</p>
        </div>

        <!-- Research Navigation -->
        <div class="research-nav">
            <div class="research-tabs">
                <div class="research-tab active" data-tab="exoplanets">
                    <i class="fas fa-globe"></i>
                    Exoplanet Data
                </div>
                <div class="research-tab" data-tab="apod">
                    <i class="fas fa-camera"></i>
                    APOD Gallery
                </div>
                <div class="research-tab" data-tab="papers">
                    <i class="fas fa-file-alt"></i>
                    Research Papers
                </div>
                <div class="research-tab" data-tab="analysis">
                    <i class="fas fa-chart-line"></i>
                    Data Analysis
                </div>
            </div>
        </div>

        <!-- Research Content -->
        <div class="research-content">
            <!-- Exoplanet Data Panel -->
            <div class="research-panel active" id="exoplanetsPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-globe"></i> NASA Exoplanet Archive</h3>
                    <div class="panel-controls">
                        <select id="exoplanetFilter" class="research-select">
                            <option value="all">All Planets</option>
                            <option value="habitable">Habitable Zone</option>
                            <option value="super-earth">Super-Earth</option>
                            <option value="gas-giant">Gas Giants</option>
                        </select>
                        <button class="research-btn" onclick="exportExoplanetData()">
                            <i class="fas fa-download"></i> Export CSV
                        </button>
                        <button class="research-btn" onclick="refreshExoplanetData()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>
                <div id="exoplanetContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading exoplanet data...</div>
                    </div>
                </div>
            </div>

            <!-- APOD Gallery Panel -->
            <div class="research-panel" id="apodPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-camera"></i> Astronomy Picture of the Day</h3>
                    <div class="panel-controls">
                        <input type="number" id="apodCount" class="research-input" placeholder="Count (1-10)" min="1" max="10" value="5">
                        <button class="research-btn" onclick="refreshAPOD()">
                            <i class="fas fa-sync-alt"></i> Load Images
                        </button>
                    </div>
                </div>
                <div id="apodContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading APOD gallery...</div>
                    </div>
                </div>
            </div>

            <!-- Research Papers Panel -->
            <div class="research-panel" id="papersPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-file-alt"></i> arXiv Astrophysics Research</h3>
                    <div class="panel-controls">
                        <input type="text" id="paperSearch" placeholder="Search papers..." class="research-input">
                        <select id="paperCategory" class="research-select">
                            <option value="astro-ph">All Astrophysics</option>
                            <option value="astro-ph.EP">Earth and Planetary</option>
                            <option value="astro-ph.GA">Galactic</option>
                            <option value="astro-ph.SR">Solar and Stellar</option>
                            <option value="astro-ph.CO">Cosmology</option>
                        </select>
                        <button class="research-btn" onclick="searchPapers()">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>
                <div id="papersContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Loading research papers...</div>
                    </div>
                </div>
            </div>

            <!-- Data Analysis Panel -->
            <div class="research-panel" id="analysisPanel">
                <div class="panel-header">
                    <h3><i class="fas fa-chart-line"></i> Space Data Analytics</h3>
                    <div class="panel-controls">
                        <select id="analysisType" class="research-select">
                            <option value="exoplanet-size">Planet Size Distribution</option>
                            <option value="star-temp">Star Temperature Analysis</option>
                            <option value="orbital-period">Orbital Period Trends</option>
                            <option value="discovery-method">Discovery Methods</option>
                        </select>
                        <button class="research-btn" onclick="generateAnalysis()">
                            <i class="fas fa-chart-bar"></i> Generate Analysis
                        </button>
                    </div>
                </div>
                <div id="analysisContent">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Preparing analysis tools...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let exoplanetData = [];
        let apodData = [];
        let paperData = [];
        let charts = {};

        // Initialize Research Mode
        document.addEventListener('DOMContentLoaded', function() {
            initializeResearchMode();
            setupEventListeners();
        });

        function initializeResearchMode() {
            // Load initial data for the active tab
            loadExoplanetData();
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.research-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Filter change for exoplanets
            document.getElementById('exoplanetFilter').addEventListener('change', function() {
                filterExoplanetData(this.value);
            });
        }

        // Tab switching functionality
        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('.research-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Show corresponding panel
            document.querySelectorAll('.research-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${tabName}Panel`).classList.add('active');

            // Load data for the selected tab
            switch(tabName) {
                case 'exoplanets':
                    if (exoplanetData.length === 0) loadExoplanetData();
                    break;
                case 'apod':
                    if (apodData.length === 0) loadAPODData();
                    break;
                case 'papers':
                    if (paperData.length === 0) loadPaperData();
                    break;
                case 'analysis':
                    initializeAnalysis();
                    break;
            }
        }

        // Exoplanet Data Functions
        async function loadExoplanetData() {
            try {
                showLoading('exoplanetContent');
                
                // NASA Exoplanet Archive API
                const query = `select top 100 pl_name,pl_orbper,pl_rade,pl_bmasse,st_teff,st_rad,st_mass,disc_method from pscomppars where pl_rade is not null and pl_orbper is not null`;
                const encodedQuery = encodeURIComponent(query);
                const apiUrl = `https://exoplanetarchive.ipac.caltech.edu/TAP/sync?query=${encodedQuery}&format=json`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('API request failed');
                
                const data = await response.json();
                exoplanetData = data;
                
                renderExoplanetData(data);
                renderExoplanetChart(data);
                
            } catch (error) {
                console.error('Error loading exoplanet data:', error);
                showError('exoplanetContent', 'Failed to load exoplanet data. Using sample data.');
                // Fallback to sample data
                exoplanetData = generateSampleExoplanetData();
                renderExoplanetData(exoplanetData);
                renderExoplanetChart(exoplanetData);
            }
        }

        function renderExoplanetData(data) {
            const content = document.getElementById('exoplanetContent');
            
            let html = `
                <div class="chart-container">
                    <h4>Planet Radius vs Orbital Period</h4>
                    <canvas id="exoplanetChart" width="800" height="400"></canvas>
                </div>
                <div class="data-grid">
            `;
            
            data.slice(0, 20).forEach(planet => {
                html += `
                    <div class="data-card">
                        <h4>${planet.pl_name || 'Unknown Planet'}</h4>
                        <p><strong>Orbital Period:</strong> ${planet.pl_orbper ? planet.pl_orbper.toFixed(2) + ' days' : 'Unknown'}</p>
                        <p><strong>Radius:</strong> ${planet.pl_rade ? planet.pl_rade.toFixed(2) + ' Earth radii' : 'Unknown'}</p>
                        <p><strong>Mass:</strong> ${planet.pl_bmasse ? planet.pl_bmasse.toFixed(2) + ' Earth masses' : 'Unknown'}</p>
                        <p><strong>Star Temperature:</strong> ${planet.st_teff ? planet.st_teff.toFixed(0) + ' K' : 'Unknown'}</p>
                        <p><strong>Discovery Method:</strong> ${planet.disc_method || 'Unknown'}</p>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function renderExoplanetChart(data) {
            const ctx = document.getElementById('exoplanetChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (charts.exoplanet) {
                charts.exoplanet.destroy();
            }
            
            const chartData = data.filter(p => p.pl_rade && p.pl_orbper).map(planet => ({
                x: planet.pl_orbper,
                y: planet.pl_rade,
                label: planet.pl_name
            }));
            
            charts.exoplanet = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Exoplanets',
                        data: chartData,
                        backgroundColor: 'rgba(0, 229, 255, 0.6)',
                        borderColor: '#00e5ff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'Orbital Period (days)',
                                color: '#00e5ff'
                            },
                            grid: {
                                color: 'rgba(0, 229, 255, 0.2)'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Planet Radius (Earth radii)',
                                color: '#00e5ff'
                            },
                            grid: {
                                color: 'rgba(0, 229, 255, 0.2)'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].raw.label;
                                },
                                label: function(context) {
                                    return `Period: ${context.parsed.x.toFixed(2)} days, Radius: ${context.parsed.y.toFixed(2)} Earth radii`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function filterExoplanetData(filter) {
            let filteredData = exoplanetData;
            
            switch(filter) {
                case 'habitable':
                    filteredData = exoplanetData.filter(p => p.pl_orbper >= 200 && p.pl_orbper <= 500);
                    break;
                case 'super-earth':
                    filteredData = exoplanetData.filter(p => p.pl_rade >= 1.25 && p.pl_rade <= 2.0);
                    break;
                case 'gas-giant':
                    filteredData = exoplanetData.filter(p => p.pl_rade >= 4.0);
                    break;
            }
            
            renderExoplanetData(filteredData);
            renderExoplanetChart(filteredData);
        }

        // APOD Functions
        async function loadAPODData() {
            try {
                showLoading('apodContent');
                
                const count = document.getElementById('apodCount').value || 5;
                const apiUrl = `https://api.nasa.gov/planetary/apod?api_key=DEMO_KEY&count=${count}`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('API request failed');
                
                const data = await response.json();
                apodData = data;
                
                renderAPODGallery(data);
                
            } catch (error) {
                console.error('Error loading APOD data:', error);
                showError('apodContent', 'Failed to load APOD data. Using sample data.');
                apodData = generateSampleAPODData();
                renderAPODGallery(apodData);
            }
        }

        function renderAPODGallery(data) {
            const content = document.getElementById('apodContent');
            
            let html = '<div class="apod-gallery">';
            
            data.forEach(apod => {
                html += `
                    <div class="apod-item">
                        ${apod.media_type === 'image' ? 
                            `<img src="${apod.url}" alt="${apod.title}" class="apod-image" loading="lazy">` :
                            `<div class="apod-image" style="background: linear-gradient(45deg, #00e5ff, #ff00c8); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">Video Content</div>`
                        }
                        <div class="apod-content">
                            <div class="apod-title">${apod.title}</div>
                            <div class="apod-date">${new Date(apod.date).toLocaleDateString()}</div>
                            <div class="apod-explanation">${apod.explanation.substring(0, 200)}...</div>
                            <a href="${apod.url}" target="_blank" class="apod-link">
                                Open Full ${apod.media_type === 'image' ? 'Image' : 'Content'} →
                            </a>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function refreshAPOD() {
            loadAPODData();
        }

        // Research Papers Functions
        async function loadPaperData() {
            try {
                showLoading('papersContent');
                
                const category = document.getElementById('paperCategory').value || 'astro-ph';
                const searchTerm = document.getElementById('paperSearch').value;
                
                let query = `cat:${category}`;
                if (searchTerm) {
                    query = `${searchTerm} AND cat:${category}`;
                }
                
                const apiUrl = `https://export.arxiv.org/api/query?search_query=${encodeURIComponent(query)}&max_results=15&sortBy=submittedDate&sortOrder=descending`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('API request failed');
                
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                const entries = xmlDoc.querySelectorAll('entry');
                const papers = Array.from(entries).map(entry => ({
                    title: entry.querySelector('title')?.textContent?.trim(),
                    authors: Array.from(entry.querySelectorAll('author name')).map(author => author.textContent).join(', '),
                    summary: entry.querySelector('summary')?.textContent?.trim(),
                    published: entry.querySelector('published')?.textContent,
                    link: entry.querySelector('id')?.textContent
                }));
                
                paperData = papers;
                renderPapers(papers);
                
            } catch (error) {
                console.error('Error loading paper data:', error);
                showError('papersContent', 'Failed to load research papers. Using sample data.');
                paperData = generateSamplePaperData();
                renderPapers(paperData);
            }
        }

        function renderPapers(papers) {
            const content = document.getElementById('papersContent');
            
            let html = '<div class="papers-list">';
            
            papers.forEach(paper => {
                const abstract = paper.summary ? paper.summary.substring(0, 300) + '...' : 'No abstract available';
                const date = paper.published ? new Date(paper.published).toLocaleDateString() : 'Unknown date';
                
                html += `
                    <div class="paper-item">
                        <div class="paper-title">${paper.title}</div>
                        <div class="paper-authors">By: ${paper.authors}</div>
                        <div class="paper-date">Published: ${date}</div>
                        <div class="paper-abstract">${abstract}</div>
                        <a href="${paper.link}" target="_blank" class="paper-link">
                            View on arXiv →
                        </a>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        function searchPapers() {
            loadPaperData();
        }

        // Data Analysis Functions
        function initializeAnalysis() {
            if (exoplanetData.length === 0) {
                loadExoplanetData().then(() => {
                    generateAnalysis();
                });
            } else {
                generateAnalysis();
            }
        }

        function generateAnalysis() {
            const analysisType = document.getElementById('analysisType').value;
            const content = document.getElementById('analysisContent');
            
            showLoading('analysisContent');
            
            setTimeout(() => {
                let html = '<div class="analysis-dashboard">';
                
                // Statistics
                html += '<div class="analysis-stats">';
                html += `
                    <div class="stat-card">
                        <div class="stat-value">${exoplanetData.length}</div>
                        <div class="stat-label">Total Exoplanets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${exoplanetData.filter(p => p.pl_rade && p.pl_rade < 2).length}</div>
                        <div class="stat-label">Earth-like Planets</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${exoplanetData.filter(p => p.pl_rade && p.pl_rade >= 4).length}</div>
                        <div class="stat-label">Gas Giants</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Math.round(exoplanetData.filter(p => p.st_teff).reduce((sum, p) => sum + p.st_teff, 0) / exoplanetData.filter(p => p.st_teff).length)}</div>
                        <div class="stat-label">Avg Star Temp (K)</div>
                    </div>
                `;
                html += '</div>';
                
                // Charts
                html += '<div class="chart-grid">';
                html += `
                    <div class="chart-item">
                        <h4>Planet Size Distribution</h4>
                        <canvas id="sizeChart" width="400" height="300"></canvas>
                    </div>
                    <div class="chart-item">
                        <h4>Star Temperature Distribution</h4>
                        <canvas id="tempChart" width="400" height="300"></canvas>
                    </div>
                `;
                html += '</div></div>';
                
                content.innerHTML = html;
                
                // Render charts
                renderAnalysisCharts(analysisType);
            }, 1000);
        }

        function renderAnalysisCharts(analysisType) {
            // Planet size distribution
            const sizeCtx = document.getElementById('sizeChart').getContext('2d');
            const sizeData = {
                labels: ['Small (< 1.25 R⊕)', 'Earth-size (1.25-2 R⊕)', 'Mini-Neptune (2-4 R⊕)', 'Gas Giant (> 4 R⊕)'],
                datasets: [{
                    data: [
                        exoplanetData.filter(p => p.pl_rade && p.pl_rade < 1.25).length,
                        exoplanetData.filter(p => p.pl_rade && p.pl_rade >= 1.25 && p.pl_rade < 2).length,
                        exoplanetData.filter(p => p.pl_rade && p.pl_rade >= 2 && p.pl_rade < 4).length,
                        exoplanetData.filter(p => p.pl_rade && p.pl_rade >= 4).length
                    ],
                    backgroundColor: ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'],
                    borderColor: '#00e5ff',
                    borderWidth: 2
                }]
            };
            
            new Chart(sizeCtx, {
                type: 'doughnut',
                data: sizeData,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
            
            // Star temperature histogram
            const tempCtx = document.getElementById('tempChart').getContext('2d');
            const tempRanges = ['< 3000K', '3000-4000K', '4000-5000K', '5000-6000K', '6000-7000K', '> 7000K'];
            const tempData = {
                labels: tempRanges,
                datasets: [{
                    label: 'Number of Stars',
                    data: [
                        exoplanetData.filter(p => p.st_teff && p.st_teff < 3000).length,
                        exoplanetData.filter(p => p.st_teff && p.st_teff >= 3000 && p.st_teff < 4000).length,
                        exoplanetData.filter(p => p.st_teff && p.st_teff >= 4000 && p.st_teff < 5000).length,
                        exoplanetData.filter(p => p.st_teff && p.st_teff >= 5000 && p.st_teff < 6000).length,
                        exoplanetData.filter(p => p.st_teff && p.st_teff >= 6000 && p.st_teff < 7000).length,
                        exoplanetData.filter(p => p.st_teff && p.st_teff >= 7000).length
                    ],
                    backgroundColor: 'rgba(0, 229, 255, 0.6)',
                    borderColor: '#00e5ff',
                    borderWidth: 2
                }]
            };
            
            new Chart(tempCtx, {
                type: 'bar',
                data: tempData,
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 229, 255, 0.2)'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 229, 255, 0.2)'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }

        // Utility Functions
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading data...</div>
                </div>
            `;
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="error-state">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p>${message}</p>
                </div>
            `;
        }

        // Export Functions
        function exportExoplanetData() {
            const csv = convertToCSV(exoplanetData);
            downloadCSV(csv, 'exoplanet_data.csv');
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvContent = [
                headers.join(','),
                ...data.map(row => headers.map(header => JSON.stringify(row[header] || '')).join(','))
            ].join('\n');
            
            return csvContent;
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function refreshExoplanetData() {
            exoplanetData = [];
            loadExoplanetData();
        }

        // Sample data generators (fallback)
        function generateSampleExoplanetData() {
            const sampleData = [];
            const planetNames = ['Kepler-442b', 'HD 40307g', 'K2-3d', 'Kepler-1649c', 'TOI-715b'];
            
            for (let i = 0; i < 50; i++) {
                sampleData.push({
                    pl_name: planetNames[i % planetNames.length] + (i > 4 ? ` ${i-4}` : ''),
                    pl_orbper: Math.random() * 1000 + 10,
                    pl_rade: Math.random() * 10 + 0.5,
                    pl_bmasse: Math.random() * 20 + 0.1,
                    st_teff: Math.random() * 4000 + 3000,
                    st_rad: Math.random() * 2 + 0.5,
                    st_mass: Math.random() * 2 + 0.5,
                    disc_method: ['Transit', 'Radial Velocity', 'Direct Imaging'][Math.floor(Math.random() * 3)]
                });
            }
            return sampleData;
        }

        function generateSampleAPODData() {
            return [
                {
                    title: "The Horsehead Nebula",
                    explanation: "One of the most identifiable nebulae in the sky, the Horsehead Nebula in Orion is part of a large, dark molecular cloud.",
                    url: "https://images.unsplash.com/photo-1502134249126-9f3755a50d78?w=800&h=600&fit=crop",
                    date: "2024-10-01",
                    media_type: "image"
                },
                {
                    title: "Galaxy Cluster Abell 2744",
                    explanation: "This massive galaxy cluster acts as a gravitational lens, bending and magnifying light from more distant galaxies.",
                    url: "https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=800&h=600&fit=crop",
                    date: "2024-09-30",
                    media_type: "image"
                }
            ];
        }

        function generateSamplePaperData() {
            return [
                {
                    title: "Atmospheric Characterization of Exoplanets with JWST",
                    authors: "Smith, J. et al.",
                    summary: "We present atmospheric observations of several exoplanets using the James Webb Space Telescope, revealing detailed chemical compositions and temperature profiles.",
                    published: "2024-09-15",
                    link: "https://arxiv.org/abs/2409.12345"
                },
                {
                    title: "Dark Matter Distribution in Galaxy Clusters",
                    authors: "Johnson, A. et al.",
                    summary: "Analysis of weak lensing data reveals new insights into the distribution of dark matter in massive galaxy clusters.",
                    published: "2024-09-10",
                    link: "https://arxiv.org/abs/2409.67890"
                }
            ];
        }
    </script>
</body>
</html>